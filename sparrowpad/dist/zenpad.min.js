ZenPen=window.ZenPen||{},ZenPen.editor=function(){function e(){E=!1,n();var e=document.createRange(),o=window.getSelection();e.setStart(q,1),o.removeAllRanges(),o.addRange(e),t(),ZenPen.util.supportsHtmlStorage()&&s()}function t(){ZenPen.util.supportsHtmlStorage()?document.onkeyup=function(e){o(e),i()}:document.onkeyup=o,document.onmousedown=o,document.onmouseup=function(e){setTimeout(function(){o(e)},1)},window.addEventListener("resize",function(e){c()}),document.body.addEventListener("scroll",function(){c()}),document.addEventListener("compositionstart",h),document.addEventListener("compositionend",N)}function n(){q=document.querySelector(".header"),k=document.querySelector(".content"),x=document.querySelector(".text-options"),L=x.querySelector(".options"),T=x.querySelector(".bold"),T.onclick=d,P=x.querySelector(".italic"),P.onclick=m,Z=x.querySelector(".quote"),Z.onclick=p,H=x.querySelector(".url"),H.onmousedown=f,A=x.querySelector(".url-input"),A.onblur=g,A.onkeydown=y}function o(e){var t=window.getSelection();return"url-input"===e.target.className||e.target.classList.contains("url")||e.target.parentNode.classList.contains("ui-inputs")?(C=r(t.focusNode),void l()):(t.isCollapsed===!0&&b===!1&&a(),t.isCollapsed===!1&&E===!1&&(C=r(t.focusNode),u(C,"ARTICLE")&&(l(),c(),x.className="text-options active")),void(b=t.isCollapsed))}function c(){var e=window.getSelection(),t=e.getRangeAt(0),n=t.getBoundingClientRect();console.log(n.top),x.style.top=n.top-15+window.pageYOffset+"px",x.style.left=(n.left+n.right)/2+"px"}function l(){u(C,"B")?T.className="bold active":T.className="bold",u(C,"I")?P.className="italic active":P.className="italic",u(C,"BLOCKQUOTE")?Z.className="quote active":Z.className="quote",u(C,"A")?H.className="url useicons active":H.className="url useicons"}function a(){x.className="text-options fade",setTimeout(function(){"text-options fade"==x.className&&(x.className="text-options",x.style.top="-999px",x.style.left="-999px")},260)}function r(e){var t={};for(window.getSelection();e.parentNode;)t[e.nodeName]=!0,e=e.parentNode,"A"===e.nodeName&&(t.url=e.href);return t}function u(e,t){return!!e[t]}function i(e){localStorage.header=q.innerHTML,localStorage.content=k.innerHTML}function s(){localStorage.header&&(q.innerHTML=localStorage.header),localStorage.content&&(k.innerHTML=localStorage.content)}function d(){document.execCommand("bold",!1)}function m(){document.execCommand("italic",!1)}function p(){var e=r(window.getSelection().focusNode);u(e,"BLOCKQUOTE")?(document.execCommand("formatBlock",!1,"p"),document.execCommand("outdent")):document.execCommand("formatBlock",!1,"blockquote")}function f(){"options"==L.className?(L.className="options url-mode",setTimeout(function(){var e=r(window.getSelection().focusNode);u(e,"A")?A.value=e.url:document.execCommand("createLink",!1,"/"),lastSelection=window.getSelection().getRangeAt(0),b=!1,A.focus()},100)):L.className="options"}function y(e){13===e.keyCode&&(e.preventDefault(),v(A.value),A.blur())}function g(e){L.className="options",v(A.value),A.value="",C=r(window.getSelection().focusNode),l()}function v(e){S(),document.execCommand("unlink",!1),""!==e&&(e.match("^(http|https)://")||(e="http://"+e),document.execCommand("createLink",!1,e))}function S(){window.getSelection().addRange(lastSelection)}function w(){var e=ZenPen.util.getText(k);return""===e?0:e.split(/\s+/).length}function h(e){E=!0}function N(e){E=!1}var q,k,b,C,x,L,T,P,Z,H,A,E;return{init:e,saveState:i,getWordCount:w}}(),ZenPen=window.ZenPen||{},ZenPen.ui=function(){function e(){supportsSave=new Blob?!0:!1,o(),wordCountActive=!1,ZenPen.util.supportsHtmlStorage()&&t(),console.log("Checkin under the hood eh? We've probably got a lot in common. You should totally check out ZenPen on github! (https://github.com/tholman/zenpen).")}function t(){localStorage.wordCount&&"0"!==localStorage.wordCount&&(H=parseInt(localStorage.wordCount),E.value=localStorage.wordCount,M.className="word-counter active",y()),"true"===localStorage.darkLayout&&(W===!1?document.body.className="yang":document.body.className="yin",W=!W)}function n(){ZenPen.util.supportsHtmlStorage()&&(localStorage.darkLayout=W,localStorage.wordCount=E.value)}function o(){if(h=document.body,q=document.querySelector(".ui"),T=document.querySelector(".color-flip"),T.onclick=l,L=document.querySelector(".fullscreen"),L.onclick=c,P=document.querySelector(".target "),P.onclick=a,supportsSave){Z=document.querySelector(".save"),Z.onclick=u;var e=document.querySelectorAll(".saveselection span");for(var t in e)e[t].onclick=g;document.querySelector(".savebutton").onclick=i}else document.querySelector(".save.useicons").style.display="none";k=document.querySelector(".overlay"),k.onclick=S,N=document.querySelector(".content"),N.onkeyup=f,A=k.querySelector(".wordcount"),E=A.querySelector("input"),E.onchange=m,E.onkeyup=d,C=k.querySelector(".description"),saveModal=k.querySelector(".saveoverlay"),M=document.querySelector(".word-counter"),B=M.querySelector(".progress"),b=document.querySelector(".about"),b.onclick=r,x=document.querySelector(".header"),x.onkeypress=s}function c(e){screenfull.toggle(),screenfull.enabled&&document.addEventListener(screenfull.raw.fullscreenchange,function(){screenfull.isFullscreen?L.innerHTML=D:L.innerHTML=O})}function l(e){W===!1?document.body.className="yang":document.body.className="yin",W=!W,n()}function a(e){k.style.display="block",A.style.display="block",E.focus()}function r(e){k.style.display="block",C.style.display="block"}function u(e){k.style.display="block",saveModal.style.display="block"}function i(e){if("undefined"!=typeof R&&""!=R){var t=new Blob([I],{type:"text/plain;charset=utf-8"}),n=x.innerHTML.replace(/(\t|\n|\r)/gm,"");""===n&&(n="ZenPen"),saveAs(t,n+".txt")}else document.querySelector(".saveoverlay h1").style.color="#FC1E1E"}function s(e){13===e.keyCode&&(e.preventDefault(),N.focus())}function d(e){13===e.keyCode&&(e.preventDefault(),p(parseInt(this.value)),w(),N.focus())}function m(e){p(parseInt(this.value))}function p(e){e>0?(H=e,M.className="word-counter active",y()):(H=0,M.className="word-counter"),n()}function f(e){H>0&&y()}function y(){var e=ZenPen.editor.getWordCount(),t=e/H;B.style.height=100*t+"%",t>=1?B.className="progress complete":B.className="progress"}function g(e){document.querySelectorAll("span.activesave").length>0&&(document.querySelector("span.activesave").className=""),document.querySelector(".saveoverlay h1").style.cssText="";var t;if(!e)var e=window.event;e.target?t=e.target:e.srcElement&&(t=e.srcElement),3==t.nodeType&&(t=t.parentNode),t.className="activesave",R=t.getAttribute("data-format");var n=document.querySelector("header.header"),o=n.innerHTML.replace(/(\r\n|\n|\r)/gm,"")+"\n",c=document.querySelector("article.content"),l=c.innerHTML;I=v(R,o,l);var a=document.querySelector(".hiddentextbox");a.value=I,a.focus(),a.select()}function v(e,t,n){var o;switch(e){case"html":t="<h1>"+t+"</h1>",o=t+n,o=o.replace(/\t/g,"");break;case"markdown":t=t.replace(/\t/g,""),t=t.replace(/\n$/,""),t="#"+t+"#",o=n.replace(/\t/g,""),o=o.replace(/<b>|<\/b>/g,"**").replace(/\r\n+|\r+|\n+|\t+/gi,"").replace(/<i>|<\/i>/g,"_").replace(/<blockquote>/g,"> ").replace(/<\/blockquote>/g,"").replace(/<p>|<\/p>/gi,"\n").replace(/<br>/g,"\n");var c=o.match(/<a href="(.+)">(.+)<\/a>/gi);if(null!==c)for(var l=0;l<c.length;l++){var a=document.createElement("div");a.innerHTML=c[l];var r=a.firstChild,u=r.getAttribute("href"),i=r.textContent||r.innerText||"";o=o.replace(c[l],"["+i+"]("+u+")")}o=t+"\n\n"+o;break;case"plain":t=t.replace(/\t/g,"");var r=document.createElement("div");r.innerHTML=n,o=r.textContent||r.innerText||"",o=o.replace(/\t/g,"").replace(/\n{3}/g,"\n").replace(/\n/,""),o=t+o}return o}function S(e){"overlay"===e.target.className&&w()}function w(){k.style.display="none",A.style.display="none",C.style.display="none",saveModal.style.display="none",document.querySelectorAll("span.activesave").length>0&&(document.querySelector("span.activesave").className=""),R=""}var h,N,q,k,b,C,x,L,T,P,Z,H,A,E,M,B,R,I,O="&#xe000;",D="&#xe004;",W=!1;return{init:e}}(),ZenPen=window.ZenPen||{},ZenPen.util=function(){function e(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}function t(e){for(var n=" ",o=e.childNodes.length,c=0;o>c;c++){var l=e.childNodes[c];8!=l.nodeType&&(n+=1!=l.nodeType?l.nodeValue:t(l))}return ZenPen.util.trim(n)}function n(e){return e.replace(/^\s+|\s+$/g,"")}return{trim:n,getText:t,supportsHtmlStorage:e}}();